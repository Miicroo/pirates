<html>
	<head>
		<title>Pirates</title>
		<link rel="stylesheet" type="text/css" href="style.css">
		<script type="text/javascript" src="js/rx.js"></script>
		
		<script type="text/javascript" src="js/Ship.js"></script>
		<script type="text/javascript" src="js/Dice.js"></script>
		<script type="text/javascript" src="js/GameBoard.js"></script>
		<script type="text/javascript" src="js/GameController.js"></script>
	</head>
	<body>
		<div id="content">
			<table id = "gameBoard">
			</table>

			<script>
				// https://www.w3.org/TR/custom-elements/
				function drawGameBoard(gameController) {
					const table = document.querySelector('#gameBoard');

					const grid = gameController.getGameBoardGrid();
					drawGrid(grid, table);

					const fleets = gameController.getFleets();
					drawFleets(fleets, table);
				}

				function drawFleets(fleets, gameBoard) {
					fleets.map(fleet => createFleet(fleet))
						  .forEach(fleet => fleet.forEach(shipObject => {
						  		const ship = shipObject.ship;
						  		const element = shipObject.element;
						  		const row = gameBoard.children[ship.y];
						  		row.children[ship.x].appendChild(element);
							})
						  );

				}

				function createFleet(fleet) {
					return fleet.map(ship => createShip(ship));
				}

				function createShip(ship) {
					const span = document.createElement('div');
					span.innerHTML = '&nbsp;';
					span.classList.add('ship');
				    span.style.backgroundColor = ship.color;

				    return {'ship': ship, 'element': span};
				}

				function drawGrid(grid, gameBoard) {
					grid.map(row => createTr(row))
						.forEach(tr => gameBoard.appendChild(tr));
				}

				function createTr(row) {
					const tr = document.createElement('tr');
					row.map(item => {
						const td = createTd(item);
						tr.appendChild(td);
					});
					return tr;
				}

				function createTd(item) {
					const td = document.createElement('td');
					td.innerText = ' ';
					td.classList.add(item.name);
					return td;
				}

				const gameController = new GameController();
				drawGameBoard(gameController);
			</script>
		</div>
	</body>
</html>